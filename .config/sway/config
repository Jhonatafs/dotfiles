# ==============================================================================
#  ARCH LINUX + SWAY
#  Foco: Performance (Sandy Bridge), Ergonomia Visual (Warm) e Controle Total.
# ==============================================================================

### VARIÁVEIS E CORES (GRUVBOX WARM) ###
set $mod Mod4
set $alt Mod1
set $term foot
set $menu fuzzel
set $tfiles yazi
set $gfiles thunar

# Paleta Gruvbox Material Hard (Warm)
set $bg      #1d2021
set $fg      #ebdbb2
set $red     #cc241d
set $green   #98971a
set $yellow  #d79921
set $blue    #458588
set $purple  #b16286
set $aqua    #689d6a
set $gray    #a89984
set $darkgray #282828

# Garantir que os portais saibam que é um Wayland/Sway
exec dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP=sway
# Define o tema para o File Picker não crashar por falta de config
set $gnome-schema org.gnome.desktop.interface
exec_always {
    gsettings set $gnome-schema gtk-theme 'Gruvbox-Material-Dark'
    gsettings set $gnome-schema icon-theme 'Gruvbox-Material-Dark'
    gsettings set $gnome-schema color-scheme 'prefer-dark'
}

### INPUT E HARDWARE ###
# Configuração de teclado ABNT2 com repetição rápida (para navegar code rápido)
input * {
    xkb_layout br
    repeat_delay 300
    repeat_rate 50
}

# Touchpad
input type:touchpad {
    dwt enabled
    tap enabled
    natural_scroll enabled
    middle_emulation enabled
}

### OUTPUT E VISUAL (SMART GAPS) ###
# output * bg $bg solid_color
output * bg ~/Imagens/wallpapers/*default* fill
bindsym $mod+F5 exec sh -c 'swaymsg output "*" bg "$(find ~/Imagens/wallpapers/ -type f | shuf -n 1)" fill'

# Smart Gaps:
# - Se houver apenas 1 janela: Sem bordas, sem gaps (Foco total).
# - Se houver >1 janela: Gaps aparecem para separar o conteúdo.
gaps inner 5
gaps outer 5
smart_gaps on
smart_borders on

# Bordas Minimalistas
default_border pixel 1
default_floating_border pixel 1

# Cores das Janelas (Aplica a paleta definida acima)
# class                 border  backgr. text    indicator child_border
client.focused          $yellow $yellow $bg     $yellow   $yellow
client.focused_inactive $gray   $gray   $bg     $gray     $gray
client.unfocused        $bg     $bg     $gray   $bg       $bg
client.urgent           $red    $red    $fg     $red      $red

### AUTOSTART (ESSENCIAIS) ###
# Inicia serviços essenciais em segundo plano
exec_always "killall waybar; waybar"
#exec_always "gammastep -O 3500"        # Filtro de Luz Azul (3500K Quente)
exec /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 # Autenticação GUI
exec mako

# Idle (Bloqueio de tela inteligente)
exec swayidle -w \
    timeout 300 'swaylock -f -c 1d2021' \
    timeout 600 'swaymsg "output * power off"' resume 'swaymsg "output * power on"' \
    before-sleep 'swaylock -f -c 1d2021'

### INPUT
# Habilitar NumLock por padrão na inicialização
input type:keyboard xkb_numlock enabled


### KEYBINDINGS ###

# --- Básicos ---
bindsym $mod+Return exec $term
bindsym $mod+d exec $menu
bindsym $mod+F2 exec foot -e $tfiles
bindsym $mod+F3 exec $gfiles
bindsym $mod+q kill
bindsym $alt+F4 kill
bindsym $mod+Shift+r reload

# --- Navegação (VIM Keys: h,j,k,l) ---
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right

bindsym $mod+left focus left 
bindsym $mod+down focus down
bindsym $mod+up focus up
bindsym $mod+right focus right 

# --- Movimentação de Janelas ---
bindsym $mod+Shift+h move left
bindsym $mod+Shift+j move down
bindsym $mod+Shift+l move right
bindsym $mod+Shift+k move up

bindsym $mod+Shift+left move left
bindsym $mod+Shift+down move down
bindsym $mod+Shift+right move right
bindsym $mod+Shift+up move up


# --- Layouts Avançados ---
# Splith (horizontal) | Splitv (vertical)
bindsym $alt+right splith
bindsym $alt+left splith
bindsym $alt+up splitv
bindsym $alt+down splitv
# Stacking (Pilha) | Tabbed (Abas) | Toggle split (Padrão)
bindsym $mod+s layout stacking
bindsym $mod+t layout tabbed
bindsym $mod+e layout toggle split
bindsym $mod+f fullscreen

# --- Floating (Flutuante) ---
floating_modifier $mod normal
bindsym $mod+Shift+space floating toggle
bindsym $mod+space focus mode_toggle


# --- Workspaces (1-10) ---
bindsym $mod+1 workspace number 1
bindsym $mod+2 workspace number 2
bindsym $mod+3 workspace number 3
bindsym $mod+4 workspace number 4
bindsym $mod+5 workspace number 5
bindsym $mod+6 workspace number 6
bindsym $mod+7 workspace number 7
bindsym $mod+8 workspace number 8
bindsym $mod+9 workspace number 9

bindsym $mod+Shift+1 move container to workspace number 1
bindsym $mod+Shift+2 move container to workspace number 2
bindsym $mod+Shift+3 move container to workspace number 3
bindsym $mod+Shift+4 move container to workspace number 4
bindsym $mod+Shift+5 move container to workspace number 5
bindsym $mod+Shift+6 move container to workspace number 6
bindsym $mod+Shift+7 move container to workspace number 7
bindsym $mod+Shift+8 move container to workspace number 8
bindsym $mod+Shift+9 move container to workspace number 9

# --- Scratchpad (A "Gaveta" Invisível) ---
# Envia janela para o limbo
bindsym $mod+Shift+minus move scratchpad
# Traz a janela de volta (flutuando)
bindsym $mod+minus scratchpad show

# --- Screenshots (GRIM + SLURP) ---
# Captura a tela inteira instantaneamente
bindsym Print exec grim ~/Imagens/Screenshots/$(date +'%Y-%m-%d-%H%M%S.png')
# Captura uma área da tela selecionada manualmente
# Selecionar Área -> Copia para Área de Transferência
bindsym $mod+Shift+s exec slurp | grim -g - - | wl-copy
# Selecionar Área -> Salva na pasta
bindsym Control+Print exec slurp | grim -g - ~/Imagens/Screenshots/$(date +'%Y-%m-%d-%H%M%S.png')

# Loock
bindsym $mod+Escape exec swaylock -f -c 1d2021

### MODOS DE OPERAÇÃO (SAFETY & RESIZE) ###

# Modo Resize (Padrão do Sway, ajustado)
mode "resize" {
    bindsym h resize shrink width 10px
    bindsym j resize grow height 10px
    bindsym k resize shrink height 10px
    bindsym l resize grow width 10px

    bindsym left resize shrink width 5px
    bindsym down resize grow height 5px
    bindsym up resize shrink height 5px
    bindsym right resize grow width 5px

    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+r mode "resize"

# === MENU DE SISTEMA (SWAYNAG) ===
# Atalho: Super + 0
# Cria uma barra no topo com botões para Desligar, Reiniciar, Sair ou Bloquear.

bindsym $mod+0 exec swaynag -t warning -m 'Menu de Sistema:' \
    -B 'Desligar' 'systemctl poweroff' \
    -B 'Reiniciar' 'systemctl reboot' \
    -B 'Sair (Logout)' 'swaymsg exit' \
    -B 'Bloquear' 'swaylock -f -c 1d2021'

### REGRAS DE JANELA ###
# Define comportamento padrão para certos apps

# Apps que sempre devem flutuar
for_window [app_id="pavucontrol"] floating enable, resize set 600 400
for_window [app_id="nm-connection-editor"] floating enable
for_window [app_id="blueman-manager"] floating enable
for_window [app_id="galculator"] floating enable
for_window [app_id="^launcher$"] floating enable, sticky enable, resize set 30% 30%
for_window [title="Picture-in-Picture"] floating enable, sticky enable

# Inibir descanso de tela se estiver rodando vídeo em tela cheia (Firefox/MPV)
for_window [class="^.*"] inhibit_idle fullscreen
for_window [app_id="^.*"] inhibit_idle fullscreen

# Trasparencia
for_window [app_id="code"] opacity set 0.92
for_window [app_id="org.mozilla.firefox"] opacity set 0.95
for_window [app_id="com.brave.Browser"] opacity set 0.95
# Keybindings
# Alternar entre transparência para quando estiver assistindo algo
bindsym $mod+F9 exec 'swaymsg [app_id="org.mozilla.firefox"] opacity set 0.95'
bindsym $mod+F10 exec 'swaymsg [app_id="org.mozilla.firefox"] opacity set 1.0'

